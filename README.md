# マークシート自動採点システム (Web版)

ブラウザ上で動作するマークシート自動採点システムです。PDFをアップロードするだけで、解析から採点、Excel出力まで完結します。

## 推奨環境・スキャン設定

**スキャン時の品質が解析精度に大きく影響します。**

*   **複合機**: 7F印刷室の **bizhub C750i** を推奨。
*   **解像度**: **600dpi 推奨**。
    *   デフォルトの300dpiでスキャンした場合は、アプリ内の「閾値 (二値化)」設定を **200付近** まで下げることで認識しやすくなります。
*   **向き**: すべての用紙の向きを揃えてスキャンしてください。
*   **形式**: PDFファイル。

## 準備手順

1.  **正答キーの作成**:
    *   マークシートの **1枚目** を正解（模範解答）としてマークしてください。
    *   1枚目の学籍番号欄は空欄（マークなし）で構いません。
2.  **PDF作成**:
    *   1枚目に「正答キー」、2枚目以降に「学生の回答用紙」となるようにまとめてスキャンし、1つのPDFファイルにしてください。

## 使い方

### 1. ファイルのアップロード
画面左上の「ファイル選択」エリアに作成したPDFファイルをドラッグ＆ドロップ（またはクリックして選択）します。

### 2. エリアと設定の確認
PDFが表示されたら、右画面を見ながら以下の確認を行ってください。

*   **認識枠（赤い枠）の確認**:
    *   学籍番号エリアと回答ブロックの赤い枠が、実際のマーク欄（数字部分）に重なっているか確認してください。
    *   **修正方法**: ズレている場合は、左サイドパネルの設定内の「エリアを指定」ボタンを押し、マウスドラッグでcorrectly囲み直してください。
*   **ブロック設定**:
    *   **有効選択肢数**: 各ブロックで採点対象とする選択肢の範囲（1～10）を指定します。
        *   例: 「4」を指定すると、1～4のマークのみを読み取り、5以降のマークは無視（グレー表示）されます。マーク座標自体は常に1～0（10個）を囲うように設定してください。

### 3. 1枚目の解析（テスト）
設定が済んだら、**「1枚目を解析（正答設定）」** ボタンを押します。

*   **画質調整**:
    *   読み取りがうまくいかない（例：マークが薄すぎる、背景が濃すぎる）場合は、「**コントラスト**」スライダーを調整して文字やマークを際立たせてください。
    *   「二値化表示」チェックボックスをONにすると、コンピュータが画像をどう見ているかを確認できます。
*   **閾値・感度**:
    *   必要に応じて「閾値 (二値化)」や「マーク判定感度」を調整し、ノイズがなくマークだけが黒く表示される状態を目指してください。

### 4. 全ページ採点
1枚目の解析結果に問題がなければ、**「全ページ採点開始」** ボタンを押します。
自動的に全ページの解析と採点が行われます。

### 5. 結果の確認・その他の機能
採点完了後、自動的にオーバーレイが表示されます。

*   **配色の意味**:
    *   🟢 **緑**: 正解
    *   🔴 **赤**: 不正解
    *   🟡 **黄**: 未回答（マークなし）
    *   ⚪ **グレー**: 設定した「有効選択肢数」外の無効なマーク

#### 便利な機能
*   **現在のページを再解析**:
    *   個別ページの採点ミスなどが気になった場合、そのページを表示した状態で設定（閾値やコントラストなど）を変更し、「**現在のページを再解析**」ボタンを押すと、そのページだけを再処理できます。
*   **学生一覧（ナビゲーション）**:
    *   上部の「**≣ 一覧**」ボタンを押すと、全生徒のリストが表示されます。
    *   **フラグ**:
        *   🔴 **複数**: 1つの設問に複数のマークがある（複数回答）
        *   🔴 **未回答**: 答えが空欄になっている
        *   🔴 **不一致**: 検出されたマークの総数が、正答キーのマーク総数と異なる
        （※問題がない場合は緑のアイコン🟢が表示されます）
    *   リストの行をクリックすると、その生徒のページへ直接ジャンプします。
*   **PDF保存（オーバーレイ付）**:
    *   「**PDF保存**」ボタンを押すと、採点結果（正誤の枠線など）が書き込まれたPDFファイルをダウンロードできます。
    *   学習者へのフィードバック返却用などに最適です。ファイルサイズは軽量に保たれます。

### 6. データ出力
**「Excelエクスポート」** ボタンを押すと、採点結果を `.xlsx` ファイルとしてダウンロードできます。

**Excelファイルの構成**:
*   **1行目**: 問題番号 (Q1, Q2...)
*   **2行目**: **配点設定行**。デフォルトは0になっています。ここで各問題の点数を入力すると、最終列の合計点に自動反映されます。
*   **3行目**: 正答キー（1枚目の内容）。
*   **4行目以降**: 学生の回答データ。複数のマークがある場合は `1,2` のように文字列で出力されます。
*   **最終列**: 合計点（配点×正誤判定）。
*   **最終行**: **正答率**（各問題の正解者の割合）。

## よくある質問

*   **Q: 全く認識されない / 枠がずれる**
    *   A: スキャンの解像度が低い可能性があります。「コントラスト」や「閾値」を調整するか、「エリアを指定」で手動設定を試してください。
*   **Q: マークしていないのに反応する / ゴミを拾う**
    *   A: 「マーク判定感度」を上げる（数値を大きくする）か、二値化の「閾値」を調整してノイズを減らしてください。
*   **Q: 再スキャンするとページが増えてしまう**
    *   A: 最新版では修正されています。IDとページ番号が正しく紐付けられ、既存の結果が上書き更新されます。
*   **Q: 複数マークが「1,2」のようになる**
    *   A: 正常な動作です。Excelの採点式もこれに対応しており、正答キー側も「1,2」となっていれば正解になります。
