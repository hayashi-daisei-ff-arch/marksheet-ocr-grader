# マークシート自動採点システム (Web版)

ブラウザ上で動作するマークシート自動採点システムです。PDFをアップロードするだけで、解析から採点、Excel出力まで完結します。

## 推奨環境・スキャン設定

**スキャン時の品質が解析精度に大きく影響します。**

*   **複合機**: 7F印刷室の **bizhub C750i** を推奨。
*   **解像度**: **600dpi 推奨**。
    *   デフォルトの300dpiでスキャンした場合は、アプリ内の「閾値 (二値化)」設定を **200付近** まで下げることで認識しやすくなります。
*   **向き**: すべての用紙の向きを揃えてスキャンしてください。
*   **形式**: PDFファイル。

## 準備手順

1.  **正答キーの作成**:
    *   マークシートの **1枚目** を正解（模範解答）としてマークしてください。
    *   1枚目の学籍番号欄は空欄（マークなし）で構いません。
2.  **PDF作成**:
    *   1枚目に「正答キー」、2枚目以降に「学生の回答用紙」となるようにまとめてスキャンし、1つのPDFファイルにしてください。

## 使い方

### 1. ファイルのアップロード
画面左上の「ファイル選択」エリアに作成したPDFファイルをドラッグ＆ドロップ（またはクリックして選択）します。

### 2. エリアと設定の確認
PDFが表示されたら、右画面を見ながら以下の確認を行ってください。

*   **認識枠（赤い枠）の確認**:
    *   学籍番号エリアと回答ブロックの赤い枠が、実際のマーク欄（数字部分）に重なっているか確認してください。
    *   ヘッダ（「学籍番号」などの文字）を含めず、**マーク部分だけ**を囲むようにします。
    *   **修正方法**: ズレている場合は、左サイドパネルの設定内の「エリアを指定」ボタンを押し、マウスドラッグで正しい範囲を囲み直してください。
*   **ブロック数の設定**:
    *   使用する回答ブロック数を選択してください。
    *   ※使わないブロックを含めても動作しますが、Excelが横長になり、ゴミ汚れによる誤検知のリスクが増えるため、必要なブロック数に合わせることを推奨します。

### 3. 1枚目の解析（テスト）
設定が済んだら、**「1枚目を解析（正答設定）」** ボタンを押します。

*   **確認ポイント**:
    *   画面上のオーバーレイ（マーク部分の塗りつぶし）と、右下の「解析結果」パネルを見て、正しく認識されているか確認してください。
*   **調整が必要な場合**:
    *   認識漏れやノイズがある場合は、左サイドパネルの「**閾値 (二値化)**」や「**マーク判定感度**」スライダーを調整してください。
    *   「二値化表示」チェックボックスをONにすると、コンピュータが画像をどう見ているか（白黒画像）を確認できます。マークがはっきりと黒く、枠線などのノイズが少ない状態が理想です。
    *   **重要**: ここでの設定が全ページの解析に適用されます。この段階でしっかり調整してください。

### 4. 全ページ採点
1枚目の解析結果に問題がなければ、**「全ページ採点開始」** ボタンを押します。
自動的に全ページの解析と採点が行われます。進行中はロード画面が表示されます。

### 5. 結果の確認・修正
採点完了後、自動的にオーバーレイが表示されます。ページ送りボタンで各生徒の結果を確認できます。

*   **配色の意味**:
    *   🟢 **緑**: 正解
    *   🔴 **赤**: 不正解
    *   🟡 **黄**: 未回答（マークなし）
*   **手動修正**:
    *   読み取りミスや修正したい箇所がある場合、右下の「解析結果」パネルの該当箇所（学籍番号や回答番号）をクリックすると、値を直接修正できます。
    *   修正すると即座に再採点され、画面上の表示も更新されます。
    *   複数回答の場合は `1,2` のようにカンマ区切りで入力します。
    *   ※得点の合計計算などはここではなく、エクスポート後のExcelで行うことを推奨します。

### 6. データ出力
**「Excelエクスポート」** ボタンを押すと、採点結果を `.xlsx` ファイルとしてダウンロードできます。

**Excelファイルの構成**:
*   **1行目**: 問題番号 (Q1, Q2...)
*   **2行目**: **配点設定行**。デフォルトは0になっています。ここで各問題の点数を入力すると、最終列の合計点に自動反映されます。
*   **3行目**: 正答キー（1枚目の内容）。
*   **4行目以降**: 学生の回答データ。複数のマークがある場合は `1,2` のように文字列で出力されます。
*   **最終列**: 合計点（配点×正誤判定）。
*   **最終行**: **正答率**（各問題の正解者の割合）。

**補足**:
*   複数回答の設問は、正答キーと学生の回答が「完全一致」した場合のみ正解として扱われます。
*   不要な行や列（空白の質問列など）は、Excel上で非表示または削除して構いません。

## よくある質問

*   **Q: 全く認識されない / 枠がずれる**
    *   A: スキャンの解像度が低い可能性があります。「閾値」を調整するか、「エリアを指定」で手動設定を試してください。
*   **Q: マークしていないのに反応する / ゴミを拾う**
    *   A: 「マーク判定感度」を上げる（数値を大きくする）か、二値化の「閾値」を調整してノイズを減らしてください。
*   **Q: 複数マークが「1,2」のようになる**
    *   A: 正常な動作です。Excelの採点式もこれに対応しており、正答キー側も「1,2」となっていれば正解になります。
